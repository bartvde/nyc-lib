<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

	<title>OpenLayers Example</title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.4.5/jquery.mobile.min.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.20.1/ol.css" rel="stylesheet">
	<!-- nyc css -->
	<link rel="stylesheet" href="../src/main/css/nyc-base.css"> 
	<link rel="stylesheet" href="../src/main/css/control-common.css"> 
	<link rel="stylesheet" href="../src/main/css/dialog.css"> 
	<link rel="stylesheet" href="../src/main/css/collapsible.css"> 
	<link rel="stylesheet" href="../src/main/css/ol-popup.css"> 
	<link rel="stylesheet" href="../src/main/css/propertyinforenderer.css"> 
	<link rel="stylesheet" href="../src/main/css/zoomsearch.css"> 
	<!-- nyc css -->

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.4.5/jquery.mobile.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.20.1/ol.js"></script>
	<!-- nyc js -->
	<script src="../src/main/js/nyc/nyc.js"></script>
	<script src="../src/main/js/nyc/basemap.js"></script>
	<script src="../src/main/js/nyc/proximityinfo.js"></script>
	<script src="../src/main/js/nyc/propertyinforenderer.js"></script>
	<script src="../src/main/js/nyc/basemap.js"></script>
	<script src="../src/main/js/nyc/dialog.js"></script>
	<script src="../src/main/js/nyc/locate.js"></script>
	<script src="../src/main/js/nyc/locationmgr.js"></script>
	<script src="../src/main/js/nyc/geocoder.js"></script>
	<script src="../src/main/js/nyc/ctlcontainer.js"></script>
	<script src="../src/main/js/nyc/zoomsearch.js"></script>
	<script src="../src/main/js/nyc/ol/ol.js"></script>
	<script src="../src/main/js/nyc/ol/basemap.js"></script>
	<script src="../src/main/js/nyc/ol/locate.js"></script>
	<script src="../src/main/js/nyc/ol/locator.js"></script>
	<script src="../src/main/js/nyc/ol/popup.js"></script>
	<script src="../src/main/js/nyc/ol/control/zoomsearch.js"></script>
	<script src="../src/main/js/nyc/ol/source/arcgiscache.js"></script>
	<script src="../src/main/js/nyc/ol/layer/baselayer.js"></script>
	<!-- nyc js -->
	
	<style>
		 #map1, #map2 {
		 	position: fixed;
		 	top: 0;
		 	left: 0;
		 	bottom: 0;
		 	right: 50%;
		 }
		 #map2 {
		 	left: 50%;
		 	right: 0;
		 }
	</style>
</head>
<body>
	<div id="map1"></div>
	<div id="map2"></div>
	<script>
		var map1, map2, popup1, popup2, info;

		$(document).ready(function(){

			map1 = new nyc.ol.Basemap({target: $('#map1').get(0)});
			
			var layer1 = new ol.layer.Vector({source: new ol.source.Vector()});
			map1.addLayer(layer1);
			
			/* See README.md for getting your GeoClient App Id and App Key */
			new nyc.LocationMgr({
				controls: new nyc.ol.control.ZoomSearch(map1),
				locate: new nyc.ol.Locate(new nyc.Geoclient(
					'https://maps.nyc.gov/geoclient/v1/search.json?app_key=YOUR_APP_KEY&app_id=YOUR_APP_ID'
				)),
				locator: new nyc.ol.Locator({map: map1, layer: layer1})
			});

			map2 = new ol.Map({
				target: $('#map2').get(0),
				layers: [new nyc.ol.layer.BaseLayer()],
				view: new ol.View({
					projection: 'EPSG:2263',
					resolutions: nyc.ol.layer.BaseLayer.RESOLUTIONS
				})
			});
			map2.getView().fit(nyc.ol.EXTENT, map2.getSize());

			var layer2 = new ol.layer.Vector({source: new ol.source.Vector()});
			map2.addLayer(layer2);
			
			/* See README.md for getting your GeoClient App Id and App Key */
			new nyc.LocationMgr({
				controls: new nyc.ol.control.ZoomSearch(map2),
				locate: new nyc.ol.Locate(
					new nyc.Geoclient(
						'https://maps.nyc.gov/geoclient/v1/search.json?app_key=YOUR_APP_KEY&app_id=YOUR_APP_ID',
						'EPSG:2263'
					), 
					'EPSG:2263'
				),
				locator: new nyc.ol.Locator({map: map2, layer: layer2})
			});

			popup1 = new nyc.ol.Popup(map1);
			popup2 = new nyc.ol.Popup(map2);

			info = new nyc.PropertyInfoRenderer({
				extraTemplates: nyc.PropertyInfoRenderer.EXTRA_TEMPLATES
			});
			
			map1.on('click', getInfo);
			map2.on('click', getInfo);
		
		});
		
		var clickedMap, clickedCoord;
		function getInfo(event){
			var options = {projection: 'EPSG:900913', callback: showInfo}, px = event.pixel;
			if (event.map === map1){
				clickedMap = map1;
				clickedCoord = map1.getCoordinateFromPixel(px);
				options.coordinates = clickedCoord;
				options.target = $(popup1.getElement()).find('.popup-content');
			}else{
				clickedMap = map2;
				clickedCoord = map2.getCoordinateFromPixel(px);
				options.projection = 'EPSG:2263';
				options.coordinates = clickedCoord;
				options.target = $(popup2.getElement()).find('.popup-content');
			}
			info.info(options);
		};
		
		function showInfo(info){
			var popup = clickedMap === map1 ? popup1 : popup2;
			popup.show({
				coordinates: clickedCoord,
				html: info.allHtml
			});
			$(popup.getElement()).find('[data-role="collapsible"]').collapsible({
				expand: $.proxy(popup.pan, popup)
			});
		};
		
	</script>
</body>
</html>
